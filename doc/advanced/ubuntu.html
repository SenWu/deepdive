<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="DeepDive" />
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="http://deepdive.stanford.edu/stylesheets/application.css" />
    <link rel="canonical" href="http://deepdive.stanford.edu">
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://deepdive.stanford.edu/javascripts/application.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepDive</title>
  </head>

  <body>
      <script type="text/javascript">
window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
window.analytics.load("h6uwk48gwg");
window.analytics.page();
</script>
      <a href="https://github.com/hazyresearch/deepdive" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

      <div id="header">
        <div class="container">
          <row>
            <div class="col-md-4 col-md-offset-1">
              <a href="http://deepdive.stanford.edu/" class="deepdive-logo">
              <img src="http://deepdive.stanford.edu/images/header_logo.png" style="width: 250px;"/>
              </a> 
            </div>
            <div class="col-md-6 col-md-offset-1">
              <ul class="list-unstyled list-inline" id="header-nav">
                <li><a href="http://deepdive.stanford.edu/index.html">Home</a></li>
                <li><a href="http://deepdive.stanford.edu/doc/basics/installation.html">Download</a></li>
                <li><a href="http://deepdive.stanford.edu/index.html#documentation">Documentation</a></li>
                <li><a href="https://mailman.stanford.edu/mailman/listinfo/deepdive-list" target="_blank">Mailing List</a></li>
              </ul>
              
            </div>
          </row>
        </div>
      </div>

      <section id="main">
        <div class="container">
          <row>
            <div class="col-md-10 col-md-offset-1">
              <h1>DeepDive Install on Ubuntu 12.04</h1>

<p>Many thanks to Tom Mulholland for providing this guide.</p>

<p>After having <a href="http://stackoverflow.com/questions/22469188/deepdive-installation-postgresql-error">many problems</a> installing the <a href="http://deepdive.stanford.edu/">DeepDive project</a> on Ubuntu, I decided to write out a detailed guide. These problems were based on the output from the <code>test.sh</code> file provided with the source - I can’t speak to the functionality of the source just yet (just starting to learn).</p>

<p>Because I messed up a few configuration files, and this is still early in my Ubuntu experience, I decided to reinstall the OS (Precise 12.04) and redo everything from scratch. So, this guide is based off of a clean version of Ubuntu 12.04, after installing all relevant updates (via Update Manager) as of 20-Mar-2014.</p>

<p>DeepDive gives us a few prerequisites: Java, Python 2.X, PostgreSQL, and SBT. Ubuntu 12.04 already has Python 2.X, so we’ll worry about the others.</p>

<p>We’re going to go with the Ubuntu recommended OpenJDK-7. Enter the following in the terminal.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get update
sudo apt-get install openjdk-7-jdk icedtea-7-plugin
</code></pre></div>
<p>Now, let’s install SBT. Use the following link to <a href="http://repo.scala-sbt.org/scalasbt/sbt-native-packages/org/scala-sbt/sbt/0.13.1/sbt.deb">download the debian file</a> or get it <a href="http://www.scala-sbt.org/release/docs/Getting-Started/Setup.html">from the site</a>. SBT has a dependence on curl, so first I’ll install that.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get install curl
<span class="nb">cd</span> /home/tom/Downloads
sudo dpkg -i sbt.deb
</code></pre></div>
<p>Now I need to install PostgreSQL, which was by far the trickiest part. In this tutorial, I’m assuming that the computer you’re working on will also be the PostgreSQL host. It’s also important to note that DeepDive uses JSON, which is apparently not supported by PostgreSQL 9.1 and under. To install version 9.3, I’m going to use the instruction given by “Danny” in <a href="http://askubuntu.com/questions/186610/how-do-i-upgrade-to-postgres-9-2">this StackExchange post</a>, and just change the numbers to 9.3:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">wget -O - http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc <span class="p">|</span> sudo apt-key add -
sudo gedit /etc/apt/sources.list.d/pgdg.list
</code></pre></div>
<p>Add the following line <strong>to the file</strong>, then save and close:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">deb http://apt.postgresql.org/pub/repos/apt/ precise-pgdg main
</code></pre></div>
<p>Note that “precise-pgdg” corresponds to your Ubuntu version. Now let’s update and install.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get update
sudo apt-get install pgdg-keyring postgresql-9.3
</code></pre></div>
<p>Now we’ll install DeepDive. First, I need to install git, since I’m on a fresh version of the OS. Then, the instructions come from the <a href="http://deepdive.stanford.edu/doc/installation.html">DeepDive page</a>. I’m going to install DeepDive in my home directory, but if you want it somewhere else, modify the <code>cd</code> line.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get install git
<span class="nb">cd</span>
git clone https://github.com/dennybritz/deepdive.git
<span class="nb">cd </span>deepdive
sbt compile
</code></pre></div>
<p>If we run the deepdive test now, it will give us some errors:</p>

<p>cd deepdive ./test.sh</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>info<span class="o">]</span> Run completed in 8 seconds, 322 milliseconds.
<span class="o">[</span>info<span class="o">]</span> Total number of tests run: 71
<span class="o">[</span>info<span class="o">]</span> Suites: completed 18, aborted 0
<span class="o">[</span>info<span class="o">]</span> Tests: succeeded 69, failed 2, canceled 0, ignored 0, pending 3
<span class="o">[</span>info<span class="o">]</span> *** 2 TESTS FAILED ***
<span class="o">[</span>error<span class="o">]</span> Failed tests:
<span class="o">[</span>error<span class="o">]</span>   org.deepdive.test.integration.LogisticRegressionApp
<span class="o">[</span>error<span class="o">]</span>   org.deepdive.test.unit.InferenceManagerSpec
<span class="o">[</span>error<span class="o">]</span> Error during tests:
<span class="o">[</span>error<span class="o">]</span>   org.deepdive.test.unit.PostgresInferenceDataStoreSpec
<span class="o">[</span>error<span class="o">]</span>   org.deepdive.test.unit.PostgresExtractionDataStoreSpec
<span class="o">[</span>error<span class="o">]</span> <span class="o">(</span><span class="nb">test</span>:test<span class="o">)</span> sbt.TestsFailedException: Tests unsuccessful
<span class="o">[</span>error<span class="o">]</span> Total <span class="nb">time</span>: 29 s, completed Mar 20, 2014 6:45:30 PM
</code></pre></div>
<p>To fix this, we need to set up PostgreSQL. First, let’s activate the local and TCP/IP connections.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo gedit /etc/postgresql/9.3/main/postgresql.conf
</code></pre></div>
<p><strong>Modify the following line</strong> in the “Connections and Authentication” from:</p>

<p><code>#listen addresses = &#39;localhost&#39;</code></p>

<p>to:</p>

<p><code>listen_addresses = &#39;localhost, 127.0.0.1, 192.168.1.10&#39;</code></p>

<p>Note that you should check your own IP address in your network connections and use that instead of mine, which ends in .10. It’s also worth noting that localhost and 127.0.0.1 are equivalent. Now, you’ll need to make sure the port 5432 is activated/open on your router. For me, it was something like the following: Access the router from a browser typing 192.168.1.0 -&gt; Virtual servers -&gt; enable port 5432 for IP Address 192.168.1.10</p>

<p>Now we need to set up the postgres superuser for the first time. The following line will open psql as user postgres (thanks to the <a href="https://help.ubuntu.com/community/PostgreSQL">Ubuntu-PostgreSQL community Wiki</a>)</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo -u postgres psql postgres
</code></pre></div>
<p>You should see <code>postgres=#</code> and a cursor. Type the following, then enter your password of choice:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="se">\p</span>assword postgres
</code></pre></div>
<p>While we’re still in psql as the postgres superuser, let’s go ahead and create a regular user, who has the same name as your Ubuntu user account. This will make life easier (for me at least). You can use <code>\du</code> to check the characteristics of your users.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">CREATE ROLE tom WITH SUPERUSER CREATEDB CREATEROLE REPLICATION LOGIN<span class="p">;</span>
<span class="se">\d</span>u
</code></pre></div>
<p>Now add a password to that user too, then quit psql.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ALTER ROLE tom WITH PASSWORD <span class="s1">&#39;your_pa$$w0rd&#39;</span><span class="p">;</span>
<span class="se">\q</span>
</code></pre></div>
<p>Check that you are now user ‘tom’ again, and not user ‘postgres-tom.’ If the latter, type <code>exit</code></p>

<p>We now need one additional dependency to be error-free.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get install gnuplot-x11
</code></pre></div>
<p>Lastly, we need to slightly modify the <code>test.sh</code> file in the deepdive directory. It seems like there’s a bug, where the test ‘forgets’ the password you provided in the middle of the run. So, let’s just hardwire it in there.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span>
gedit deepdive/test.sh
</code></pre></div>
<p>You’ll notice the following lines right at the top.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Set username and password</span>
<span class="nb">export </span><span class="nv">PGUSER</span><span class="o">=</span><span class="k">${</span><span class="nv">PGUSER</span><span class="k">:-</span><span class="sb">`</span>whoami<span class="sb">`</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">PGPASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">PGPASSWORD</span><span class="k">:-}</span>
</code></pre></div>
<p>If you’d like to save the original file, then change the name to <code>test_original.sh</code>. We’re going to change those lines to the following (as per your case):</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Set username and password</span>
<span class="nb">export </span><span class="nv">PGUSER</span><span class="o">=</span>tom
<span class="nb">export </span><span class="nv">PGPASSWORD</span><span class="o">=</span>your_pa<span class="nv">$$</span>w0rd
</code></pre></div>
<p>OK, now go to your deepdive folder, and run the test!</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>deepdive
./test.sh
</code></pre></div>
<p>Success! Sweet, sweet success! You should see the following:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>info<span class="o">]</span> Run completed in 21 seconds, 280 milliseconds.
<span class="o">[</span>info<span class="o">]</span> Total number of tests run: 90
<span class="o">[</span>info<span class="o">]</span> Suites: completed 20, aborted 0
<span class="o">[</span>info<span class="o">]</span> Tests: succeeded 90, failed 0, canceled 0, ignored 0, pending 3
<span class="o">[</span>info<span class="o">]</span> All tests passed.
<span class="o">[</span>success<span class="o">]</span> Total <span class="nb">time</span>: 23 s, completed Mar 20, 2014 7:27:21 PM
</code></pre></div>
            </div>
          </row>
        </div>
      </section>
    
      <footer id="footer">
        <div class="container">
          <row>
            <div class="col-md-10 col-md-offset-1">
              <p class="pull-left"> 
                Copyright, 2014 deepdive.stanford.edu
                ⋅
                <a href="mailto:contact.hazy@gmail.com">Questions? Email us</a>
              </p>
              <p class="pull-right"> 
                Visit DeepDive on <a href="https://github.com/hazyresearch/deepdive" target="_blank">Github</a> 
              </p>
            </div>
          </row>
        </div>
      </footer>

    
  
  </body>
</html>
